var main=function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=18)}([function(e,t){e.exports=React},function(e,t){e.exports=utils},function(e,t){e.exports=elements},function(e,t){e.exports=model},function(e,t){e.exports=server},function(e,t){e.exports=icons},function(e,t){e.exports=stores},function(e,t){e.exports=ref},function(e,t){e.exports=Input_mod},function(e,t){e.exports=mobx_react_lite},function(e,t){e.exports=mobx},function(e,t){e.exports=Button_mod},function(e,t){e.exports=Dialog_mod},function(e,t){e.exports=MultiInput_mod},function(e,t){e.exports=RangeInput_mod},function(e,t){e.exports=ContainerPicker_mod},function(e,t){e.exports=Select_mod},function(e,t){e.exports=MonitorSummaryDialog_mod},function(e,t,o){"use strict";o.r(t),o.d(t,"default",(function(){return O}));var n=o(0),r=o(4),i=o(5),a=o(7),c=o(3),u=o(11),l=o(12),s=o(2),p=o(13),m=o(14),d=o(8),f=o(15),v=o(9),b=o(1),_=o(16),x=o(6),h=o(17),M=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))};const g=Object(v.observer)(e=>{const t=[{label:Object(b._t)("Days"),value:"days"},{label:Object(b._t)("Hours"),value:"hours"},{label:Object(b._t)("Minutes"),value:"minutes"}],o=t.filter(t=>t.value==e.autoMonitor.props.retention_time_unit);let r=1;switch(e.autoMonitor.props.retention_time_unit){case"minutes":r=60;break;case"hours":r=3600;break;case"days":r=86400}return n.createElement(s.Box,{flexDirection:"row"},n.createElement(s.Box,{mr:2},n.createElement(f.ContainerPicker,{width:300,isDisabled:e.autoMonitor.props.customized_template,containers:e.templates,value:e.autoMonitor.props.template,onChange:t=>{e.autoMonitor.props.template=t}})),n.createElement(s.Box,{mr:2},n.createElement(d.Input,{width:120,onChange:t=>e.autoMonitor.props.instance_filter=t.target.value,value:e.autoMonitor.props.instance_filter})),n.createElement(s.Box,{mr:2},n.createElement(m.RangeInput,{width:150,min:1,max:120,value:e.autoMonitor.props.check_interval_secs||1,onChange:t=>{e.autoMonitor.props.check_interval_secs=t}})),n.createElement(s.Box,{mr:2,flexDirection:"row"},n.createElement(d.Input,{width:40,isNumber:!0,onChange:t=>e.autoMonitor.props.retention_time_secs=t.target.value*r,value:e.autoMonitor.props.retention_time_secs/r}),n.createElement(s.Box,{ml:1},n.createElement(_.Select,{options:t,width:100,onChange:t=>e.autoMonitor.props.retention_time_unit=t.value,value:o}))),n.createElement(s.Box,{width:24,justifyContent:"center"},n.createElement(u.Button,{onClick:()=>M(void 0,void 0,void 0,(function*(){return e.onEditMonitor(yield(t=e.autoMonitor,M(void 0,void 0,void 0,(function*(){let e=t.props.template;if(!e)return;let o=t.props.customized_template;return e instanceof a.ContainerRef&&(e=e.resolve()),o instanceof a.ContainerRef&&(o=o.resolve()),o?o.isLoaded()||(yield o.load()):(o=e.clone(),yield o.load(),o.executionTarget=new c.ExecutionTarget(c.ExecutionTargetType.None),o.parents.clear(),o.metrics.forEach(e=>e.id=0),o.id=0,o.class="Monitor"),o}))));var t})),isSubtle:!0,isSmall:!0,isDisabled:!e.autoMonitor.props.template},n.createElement(i.cog,{width:16,height:16}))))}),E=Object(v.observer)(e=>{const t=e.templates.filter(e=>e.asTemplate()&&e.asTemplate().parameters&&null!=e.asTemplate().parameters.find(e=>"exec.instance"==e.name)).sort(Object(b.sortByFunc)(e=>e.props.name)),[o,r]=n.useState(null),[i,u]=n.useState(null);return n.useEffect(()=>{e.autoMonitors.forEach(e=>{e.props.customized_template instanceof a.ContainerRef&&e.props.customized_template.resolve()})},[]),n.createElement(n.Fragment,null,n.createElement(l.Dialog,{width:900,height:550,confirmText:Object(b._t)("Confirm"),closeText:Object(b._t)("Cancel"),isOpen:!0,title:Object(b._t)("Automatic Monitors"),onClose:e.onClose,onConfirm:()=>e.onConfirm(e.autoMonitors)},n.createElement(s.Box,{mb:1,pb:1,borderBottom:"1px solid",borderColor:"subtleBorder"},n.createElement(s.Box,{width:300,mr:2},Object(b._t)("Monitor")),n.createElement(s.Box,{width:120,mr:2},Object(b._t)("Instance filter")),n.createElement(s.Box,{width:150,mr:2},Object(b._t)("Check interval")),n.createElement(s.Box,{width:150,mr:2},Object(b._t)("Remove monitors"))),n.createElement(p.MultiInput,{allowDeleteLast:!0,newValueText:Object(b._t)("Add"),createNewValue:()=>{const t=new c.Obj(x.rootStore.objectStore);return t.type="AutoMonitor",t.props.device_id=e.device.id,t.props.retention_time_secs=604800,t.props.retention_time_unit="days",t},renderInput:o=>n.createElement(g,{templates:t,autoMonitor:e.autoMonitors[o],onEditMonitor:e=>M(void 0,void 0,void 0,(function*(){r(e.toViewModel()),u(o)}))}),values:e.autoMonitors})),o&&n.createElement(h.MonitorSummaryDialog,{monitor:o.asMonitor(),onClose:()=>r(null),onConfirm:()=>M(void 0,void 0,void 0,(function*(){o.commit(),e.autoMonitors[i].props.customized_template=o.model,r(null)}))}))});var y=o(10),w=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))};function j(e,t,o){return w(this,void 0,void 0,(function*(){t.autoMonitors=[];(yield r.object.query("AutoMonitor","props.device_id = "+o.id)).forEach(o=>{const n=new c.Obj(e.store.rootStore.objectStore);n.updateFromJs(o),t.autoMonitors.push(n)});const n=yield r.container.get(o.asDevice().templateGroups.map(e=>e.id));t.templates=[],n.forEach(e=>{const o=new c.Container(x.rootStore.containerStore);o.updateFromJs(e),t.templates=t.templates.concat.apply(t.templates,o.children)}),t.editingForDevice=o}))}function O(e){return w(this,void 0,void 0,(function*(){const t=Object(y.observable)({editingForDevice:null,autoMonitors:[],templates:[]});e.registerDeviceActionButton(Object(b._t)("Automatic monitors"),n.createElement(i.wand,{width:18,height:18}),j.bind(null,e,t));const o=e=>{e.forEach(e=>w(this,void 0,void 0,(function*(){const t=e.props.customized_template;if(t instanceof c.Container){const e=yield r.container.put(t,t.metrics);t.id=e[t.localId]}r.object.put(e)})))};e.registerRenderFunc(()=>t.editingForDevice&&n.createElement(E,{device:t.editingForDevice,autoMonitors:Object(y.observable)(t.autoMonitors.slice()),templates:t.templates,onConfirm:n=>{t.autoMonitors.forEach(t=>{n.find(e=>e.id==t.id)||(console.log("Deleting auto monitor "+t.id),e.callFunc("delete_auto_monitor",[t.id]))}),o(n),t.editingForDevice=null},onClose:()=>t.editingForDevice=null}))}))}}]).default;